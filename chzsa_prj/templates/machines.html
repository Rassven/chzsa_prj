{% extends 'base/default.html' %}
{% load static %}

{% comment 'Comment' %}{% load custom_filters %}
{% load custom_tags %}{% endcomment %}

{% block title %}
    Machines (вкладка в браузере)
{% endblock title %}

{% block content %}
<p style="color:#ff0000">Begin template machines.html</p>
<p>Всего объектов: {{ machines|length }}</p>
<a href="{% static 'test_output.xlsx' %}" download>Скачать пробный файл Excel</a>
<hr>
{% comment "filter" %}
    <form action="" method="get">
        {% csrf_token %}
        {{ filterset.form.as_p }}
        <input type="submit" value="Найти" />
    </form>
{% endcomment %}

{% if user.is_active %}
    {% if machines %}
        Has machines!
        <table style="background-color: #cccccc; color: #000000; text-align: center;">
            <tr style="text-align: center;">
                <td>Id</td>
                <td>Serial number</td>
                <td>Model</td>
                <td>Creation date</td>
                <td>Engine</td>
                <td>Transmission</td>
                <td>Drive bridge</td>
                <td>Controlled bridge</td>
                <td>Package contents</td>
                <td>Delivery agreement</td>
                <td>Shipment date</td>
                <td>End user</td>
                <td>End user address</td>
                <td>Client</td>
                <td>Service company</td>
                <td>Work history</td>
                <td>Is active</td>
                <td>Actions</td>
            </tr>
            {% for machine in machines %}
            <tr style="text-align: center;">
                <td>{{ machine.id }}</td>
                <td><a href="machine/{{ machine.id }}">{{ machine.machine_number }}</a></td>
                <td title="MachineModelsList/machine.machine_model.id">{{ machine.machine_model.name }}</td>
                <td>{{ machine.creation_date|date:'Y-m-d / H:i:s' }}</td>
                <td title="EngineModelsList/{{ machine.engine_number }}">{{ machine.engine_model.name }}</td>
                <td title="TransmissionModelsList/{{ machine.transmission_number }}">{{ machine.transmission_model.name }}</td>
                <td title="DriveBridgeModelsList/{{ machine.drive_bridge_number }}">{{ machine.drive_bridge_model.name }}</td>
                <td title="ControlledBridgeModelsList/{{ machine.controlled_bridge_number }}">{{ machine.controlled_bridge_model.name }}</td>
                <td><iframe src="{% static 'demo.py' %}" class="frame1">Specification</iframe></td>
                <td>{{ machine.info_about_delivery_agreement }}</td>
                <td>{{ machine.shipment_date|date:'Y-m-d / H:i:s' }}</td>
                <td title="EndUsersList/{{ machine.end_user.id }}">{{ machine.end_user.name }}</td>
                <td>{{ machine.end_user_address }}</td>
                <td title="ClientsList/{{ machine.client.id }}">{{ machine.client.name }}</td>
                <td title="ServiceCompaniesList/{{ machine.service_company.id }}">{{ machine.service_company.name }}</td>
                <td>{{ machine.work_history }}</td>
                <td>{{ machine.is_active }}</td>
                <td><a style="color: #00ff00" href="machine/{{ machine.id }}">View</a></td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <h2>Пока нет машин.</h2>
    {% endif %}
{% else %}
Страница доступна только авторизованным пользователям (хотя, в view вроде прописан permission (проверить!))
{% endif %}

{% comment 'Comment' %}
{# страничительство #}
{% if paginator.num_pages > 1 %}
<h2 style="text-align: center">
    pages<
{% if page_obj.has_previous %}
    <a href="?{% url_replace page=1 %}">1</a>
    {% if page_obj.previous_page_number != 1 %}
        ...<a href="?{% url_replace page=page_obj.previous_page_number %}">{{ page_obj.previous_page_number }}</a>
    {% endif %}
{% endif %}
{{ page_obj.number }}
{% if page_obj.has_next %}
    <a href="?{% url_replace page=page_obj.next_page_number %}">{{ page_obj.next_page_number }}</a>
    {% if paginator.num_pages != page_obj.next_page_number %}
        ...<a href="?{% url_replace page=page_obj.paginator.num_pages %}">{{ page_obj.paginator.num_pages }}</a>
    {% endif %}
{% endif %}
></h2>
{% else %}
Без страничительства
{% endif %}
{% endcomment %}

<p style="color:#ff0000">End template machines.html</p>
{% endblock content %}
